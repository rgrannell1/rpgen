
"use strict"




const rand      = require('rpgen/crypto/rand-int')
const commons   = require('rpgen/commons/commons')
const readWords = require('rpgen/fs/read-words')
const entropy   = require('rpgen/crypto/entropy')





const chooseWords = (args, callback) => {

	readWords(args.stdin ? null : args.fpath, (err, content) => {

		const charset    = commons.string.getCharset(content.join(''), true)
		const words      = content.map(word => word.toLowerCase( ))

		commons.async.repeat(args.number, rand, randNums => {

			const selected = randNums.map(num => {
				return words[Math.floor(words.length * num)]
			})

			const selectedLength = selected
				.map(word => {
					return word.length
				})
				.reduce((acc, num) => {
					return acc + num
				}, 0)

			const dictEntropy = entropy.shannonEntropyOf(args.number,    words.length)
			const charEntropy = entropy.shannonEntropyOf(selectedLength, charset.length)

			callback({
				selected,
				entropies: {
					dictEntropy,
					charEntropy
				}
			})

		})

	})

}





module.exports = chooseWords
