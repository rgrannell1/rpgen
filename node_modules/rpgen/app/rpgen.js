
"use strict"




const path        = require('path')

const chooseWords = require('rpgen/crypto/choose-words')
const showOutput  = require('rpgen/app/show-output')




const rpgen = rawArgs => {

	const args = rpgen.validate(rpgen.preprocess(rawArgs))

	chooseWords(args, showOutput.bind({ }, args))

}

rpgen.preprocess = rawArgs => {

	const fpath = rawArgs['--words']
		? path.resolve(rawArgs['--words'])
		: path.resolve(path.join(__dirname, '../../..'), 'data/words.txt' )

	return {
		number:       parseInt(rawArgs['--num'], 10),
		stdin:        rawArgs['-'],
		fpath:        fpath,
		passwordOnly: rawArgs['--password-only'],
		delimiter:    rawArgs['--delimiter']
	}

}

rpgen.validate = args => {

	if (args.number === 0) {

		process.stderr.write('rpgen: cannot create length-zero password.\n')
		process.exit(1)

	}

	if (args.number < 0) {

		process.stderr.write('rpgen: cannot create negative length password.\n')
		process.exit(1)

	}

	if (args.number !== args.number) {

		process.stderr.write('rpgen: NaN or Infinity used as a password length.\n')
		process.exit(1)

	}

	return args

}





module.exports = rpgen
